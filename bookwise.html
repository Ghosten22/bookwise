<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BookWise — Key Insights from the World's Best Books</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Newsreader:ital,opsz,wght@0,6..72,300;0,6..72,400;0,6..72,600;0,6..72,700;1,6..72,400&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
:root{--bg:#F8F7F4;--bg-card:#FFFFFF;--bg-el:#F1F0EC;--t1:#1B1B18;--t2:#5C5C56;--t3:#9A9A92;--green:#2A6B4A;--gl:#E4F0E8;--gd:#1D4D35;--gh:#237040;--amber:#C07D2B;--al:#FFF5E6;--red:#B84040;--bdr:#E5E4DF;--bl:#EDECE7;--s1:0 1px 2px rgba(0,0,0,.04);--s2:0 4px 20px rgba(0,0,0,.06);--s3:0 12px 48px rgba(0,0,0,.09);--rs:8px;--rm:12px;--rl:16px;--rx:22px;--fd:'Newsreader',Georgia,serif;--fb:'Outfit',system-ui,sans-serif;--ez:cubic-bezier(.4,0,.2,1)}
html{scroll-behavior:smooth}
body{font-family:var(--fb);background:var(--bg);color:var(--t1);-webkit-font-smoothing:antialiased;line-height:1.6;overflow-x:hidden}
::selection{background:var(--green);color:#fff}
input,button,textarea,select{font-family:inherit}
button{cursor:pointer}
::-webkit-scrollbar{width:5px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:var(--bdr);border-radius:3px}

@keyframes fu{from{opacity:0;transform:translateY(14px)}to{opacity:1;transform:translateY(0)}}
@keyframes fi{from{opacity:0}to{opacity:1}}
@keyframes bg{from{height:0}}
.af{animation:fu .5s var(--ez) both}.afi{animation:fi .4s var(--ez) both}
.d1{animation-delay:.06s}.d2{animation-delay:.12s}.d3{animation-delay:.18s}.d4{animation-delay:.24s}.d5{animation-delay:.3s}.d6{animation-delay:.36s}

.app{display:none}.app.on{display:flex}
.side{width:230px;min-height:100vh;background:var(--bg-card);border-right:1px solid var(--bl);padding:24px 14px;display:flex;flex-direction:column;position:fixed;left:0;top:0;z-index:100}
.mn{margin-left:230px;flex:1;padding:32px 40px;min-height:100vh}

.logo{display:flex;align-items:center;gap:10px;padding:0 8px;margin-bottom:36px}
.lm{width:34px;height:34px;background:var(--green);border-radius:9px;display:flex;align-items:center;justify-content:center;color:#fff}
.lt{font-family:var(--fd);font-size:21px;font-weight:700;letter-spacing:-.02em;color:var(--t1)}
.ni{width:100%;display:flex;align-items:center;gap:10px;padding:10px 12px;border:none;border-radius:var(--rs);margin-bottom:3px;background:transparent;color:var(--t2);font-size:14px;font-weight:400;transition:all .15s var(--ez)}
.ni:hover{background:var(--bg-el);color:var(--t1)}.ni.on{background:var(--gl);color:var(--green);font-weight:600}
.ni svg{width:18px;height:18px;flex-shrink:0}
.sf{border-top:1px solid var(--bl);padding-top:16px;margin-top:auto}
.ub{display:flex;align-items:center;gap:10px;padding:8px;margin-bottom:8px}
.av{width:34px;height:34px;border-radius:50%;background:var(--green);color:#fff;display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:600;flex-shrink:0}
.av-l{width:64px;height:64px;font-size:24px}
.un{font-size:13px;font-weight:500}.up{font-size:11px;color:var(--t3);text-transform:capitalize}
.lo{width:100%;display:flex;align-items:center;gap:8px;padding:9px 12px;border:none;border-radius:var(--rs);background:transparent;color:var(--t3);font-size:13px;transition:all .15s var(--ez)}.lo:hover{background:var(--bg-el);color:var(--t1)}

.btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;border:none;border-radius:var(--rs);font-weight:500;letter-spacing:.01em;transition:all .18s var(--ez);white-space:nowrap}
.bp{background:var(--green);color:#fff}.bp:hover{background:var(--gh)}
.bs{background:var(--bg-el);color:var(--t1);border:1px solid var(--bdr)}.bs:hover{border-color:var(--t3)}
.bo{background:transparent;color:var(--green);border:1.5px solid var(--green)}.bo:hover{background:var(--gl)}
.bg{background:transparent;color:var(--t2);border:none}.bg:hover{color:var(--t1);background:var(--bg-el)}
.bsm{padding:6px 14px;font-size:13px}.bmd{padding:10px 22px;font-size:14px}.blg{padding:14px 32px;font-size:15px}
.bf{width:100%}.btn:disabled{opacity:.45;pointer-events:none}

.ig{margin-bottom:16px}.il{display:block;margin-bottom:6px;font-size:13px;font-weight:500;color:var(--t2)}
.inp{width:100%;padding:11px 14px;border:1px solid var(--bdr);border-radius:var(--rs);font-size:14px;background:var(--bg);color:var(--t1);outline:none;transition:border-color .15s var(--ez)}.inp:focus{border-color:var(--green)}
.sw{position:relative}.sw .inp{padding-left:40px}.sw svg{position:absolute;left:13px;top:50%;transform:translateY(-50%);color:var(--t3);pointer-events:none}

.ap{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px;background:linear-gradient(155deg,#F8F7F4 0%,#E4F0E8 45%,#F1F0EC 100%)}
.aw{width:100%;max-width:420px}
.ac{background:var(--bg-card);border-radius:var(--rl);padding:32px;box-shadow:var(--s3);border:1px solid var(--bl)}
.at{display:flex;margin-bottom:28px;background:var(--bg-el);border-radius:var(--rs);padding:3px}
.atb{flex:1;padding:9px;border:none;border-radius:6px;font-size:13px;font-weight:500;background:transparent;color:var(--t3);transition:all .15s var(--ez)}.atb.on{background:#fff;color:var(--t1);box-shadow:var(--s1)}

.bc{background:var(--bg-card);border-radius:var(--rm);overflow:hidden;border:1px solid var(--bl);transition:all .2s var(--ez);box-shadow:var(--s1);cursor:pointer}
.bc:hover{box-shadow:var(--s2);transform:translateY(-3px)}
.bcv{height:185px;background-size:cover;background-position:center;position:relative}
.bsv{position:absolute;top:10px;right:10px;width:32px;height:32px;border-radius:50%;background:rgba(255,255,255,.92);border:none;display:flex;align-items:center;justify-content:center;backdrop-filter:blur(8px);transition:transform .15s var(--ez)}.bsv:hover{transform:scale(1.1)}
.bct{position:absolute;bottom:10px;left:10px;background:rgba(255,255,255,.92);backdrop-filter:blur(8px);padding:4px 10px;border-radius:20px;font-size:11px;font-weight:500;color:var(--t2)}
.bi{padding:16px}.bt{font-family:var(--fd);font-size:16px;font-weight:600;margin-bottom:3px;line-height:1.3}
.ba{font-size:13px;color:var(--t2);margin-bottom:10px}.bm{display:flex;align-items:center;gap:12px;font-size:12px;color:var(--t3)}
.bm .rt{color:var(--amber);display:flex;align-items:center;gap:3px}.bm .dr{display:flex;align-items:center;gap:3px}

.g4{display:grid;grid-template-columns:repeat(auto-fill,minmax(245px,1fr));gap:20px}
.g3{display:grid;grid-template-columns:repeat(3,1fr);gap:16px}
.g2{display:grid;grid-template-columns:1fr 1fr;gap:20px}

.hero{background:linear-gradient(135deg,var(--green) 0%,#1A3A26 100%);border-radius:var(--rx);padding:48px 44px;margin-bottom:48px;color:#fff;position:relative;overflow:hidden}
.hero::after{content:'';position:absolute;top:0;right:0;width:340px;height:100%;background:radial-gradient(circle at 80% 20%,rgba(255,255,255,.08) 0%,transparent 60%);pointer-events:none}
.hero h1{font-family:var(--fd);font-size:34px;font-weight:700;line-height:1.2;margin-bottom:12px;max-width:520px}

.st{font-family:var(--fd);font-size:22px;font-weight:600}
.cp{display:flex;gap:8px;margin-bottom:28px;flex-wrap:wrap}
.cpl{padding:7px 16px;border-radius:20px;border:1px solid var(--bdr);font-size:13px;font-weight:500;background:transparent;color:var(--t2);transition:all .15s var(--ez)}.cpl:hover{border-color:var(--t3)}.cpl.on{border-color:var(--green);background:var(--green);color:#fff}

.tabs{display:flex;gap:4px;margin-bottom:28px;background:var(--bg-el);border-radius:var(--rs);padding:3px;width:fit-content}
.tb{padding:8px 18px;border-radius:6px;border:none;font-size:13px;font-weight:500;background:transparent;color:var(--t3);transition:all .15s var(--ez)}.tb.on{background:#fff;color:var(--t1);box-shadow:var(--s1)}

.es{text-align:center;padding:60px 20px;color:var(--t3)}.es svg{width:48px;height:48px;margin-bottom:16px;opacity:.5}.es p{font-size:15px}

.rh{display:flex;align-items:center;gap:16px;margin-bottom:28px}
.rb{background:none;border:none;color:var(--t2);display:flex;padding:4px;transition:color .15s}.rb:hover{color:var(--t1)}
.rtl{font-family:var(--fd);font-size:26px;font-weight:700;margin-bottom:2px}
.rau{font-size:14px;color:var(--t2)}

.pb{margin-bottom:24px}.pbl{display:flex;justify-content:space-between;margin-bottom:6px;font-size:12px;color:var(--t3)}
.pt{height:4px;background:var(--bdr);border-radius:2px;overflow:hidden}.pf{height:100%;background:var(--green);border-radius:2px;transition:width .3s ease}

.abr{background:var(--bg-el);border-radius:var(--rm);padding:16px 20px;display:flex;align-items:center;gap:16px;margin-bottom:28px}
.plb{width:46px;height:46px;border-radius:50%;background:var(--green);color:#fff;border:none;display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:background .15s}.plb:hover{background:var(--gh)}
.aif{flex:1}.ail{font-size:13px;font-weight:500;margin-bottom:8px;display:flex;align-items:center;gap:6px}
.ait{height:4px;background:var(--bdr);border-radius:2px;overflow:hidden}.aifll{height:100%;background:var(--green);border-radius:2px;transition:width .1s linear}
.atm{font-size:12px;color:var(--t3);font-variant-numeric:tabular-nums;white-space:nowrap}

.ids{display:flex;gap:6px;margin-bottom:24px;flex-wrap:wrap}
.idd{width:34px;height:34px;border-radius:50%;border:none;font-size:12px;font-weight:500;transition:all .15s var(--ez)}
.idd.cur{background:var(--green);color:#fff}.idd.rd{background:var(--gl);color:var(--green)}.idd.ur{background:var(--bg-el);color:var(--t3)}

.ic{background:var(--bg-card);border-radius:var(--rl);padding:40px;border:1px solid var(--bl);box-shadow:var(--s1);margin-bottom:24px}
.inum{font-size:12px;color:var(--green);font-weight:600;text-transform:uppercase;letter-spacing:.08em;margin-bottom:8px}
.ihd{font-family:var(--fd);font-size:24px;font-weight:600;margin-bottom:22px;line-height:1.3}
.ibd{font-size:16px;line-height:1.85;color:var(--t2)}
.rnv{display:flex;justify-content:space-between}

.prc{background:var(--bg-card);border-radius:var(--rl);padding:28px;border:1px solid var(--bl);margin-bottom:24px}
.sbg{padding:4px 12px;border-radius:20px;font-size:12px;font-weight:600;text-transform:capitalize}
.sbp{background:var(--gl);color:var(--green)}.sbb{background:var(--al);color:var(--amber)}.sbf{background:var(--bg-el);color:var(--t2)}

.plc{background:var(--bg-card);border-radius:var(--rm);padding:24px;border:1px solid var(--bl);text-align:center;position:relative;transition:all .2s var(--ez)}.plc:hover{box-shadow:var(--s2)}
.plc.cur{border:2px solid var(--green)}
.pcb{position:absolute;top:-10px;left:50%;transform:translateX(-50%);background:var(--green);color:#fff;padding:2px 12px;border-radius:10px;font-size:11px;font-weight:600}
.pln{font-size:16px;font-weight:600;margin-bottom:4px}
.plp{font-family:var(--fd);font-size:30px;font-weight:700;margin-bottom:16px}.plp span{font-size:14px;font-weight:400;color:var(--t3)}
.plf{display:flex;align-items:center;gap:6px;font-size:13px;color:var(--t2);margin-bottom:6px;justify-content:center}

.ph{display:flex;justify-content:space-between;align-items:center;margin-bottom:28px}
.ptl{font-family:var(--fd);font-size:28px;font-weight:700}

.scd{background:var(--bg-card);border-radius:var(--rm);padding:24px;border:1px solid var(--bl)}
.sci{width:42px;height:42px;border-radius:var(--rs);display:flex;align-items:center;justify-content:center;margin-bottom:14px;background:var(--gl);color:var(--green)}
.sct{display:flex;justify-content:space-between;align-items:start;margin-bottom:12px}
.sch{font-size:12px;font-weight:600;color:var(--green);display:flex;align-items:center;gap:2px}
.scl{font-size:12px;color:var(--t3);margin-bottom:4px}
.scv{font-family:var(--fd);font-size:27px;font-weight:700}

.ccd{background:var(--bg-card);border-radius:var(--rl);padding:28px;border:1px solid var(--bl);margin-bottom:24px}
.cct{font-family:var(--fd);font-size:18px;font-weight:600;margin-bottom:24px}
.cbs{display:flex;align-items:flex-end;gap:16px;height:200px}
.ccl{flex:1;display:flex;flex-direction:column;align-items:center;height:100%}
.cbw{flex:1;width:100%;display:flex;align-items:flex-end}
.cb{width:100%;border-radius:6px 6px 0 0;background:linear-gradient(180deg,var(--green) 0%,var(--gd) 100%);animation:bg .6s var(--ez) both;min-height:4px}
.cbl{background:var(--gl)!important;border:1px solid var(--green);border-bottom:none}
.cmn{font-size:11px;color:var(--t3);margin-top:8px;font-weight:500}.cvl{font-size:11px;color:var(--t2);font-weight:500}

.tw{background:var(--bg-card);border-radius:var(--rl);border:1px solid var(--bl);overflow:hidden}
table{width:100%;border-collapse:collapse}
th{text-align:left;padding:14px 16px;font-size:12px;font-weight:600;color:var(--t3);text-transform:uppercase;letter-spacing:.05em;border-bottom:1px solid var(--bl)}
td{padding:12px 16px;border-bottom:1px solid var(--bl);font-size:13px}
tr:last-child td{border-bottom:none}
tbody tr{transition:background .1s}tbody tr:hover{background:var(--bg-el)}
.tbk{display:flex;align-items:center;gap:12px}
.tth{width:36px;height:48px;border-radius:4px;background-size:cover;background-position:center;flex-shrink:0}

.tbr{display:flex;align-items:center;gap:12px;padding:10px 0;border-bottom:1px solid var(--bl)}.tbr:last-child{border-bottom:none}
.trk{font-size:14px;font-weight:600;color:var(--t3);width:24px}

.ir{display:flex;justify-content:space-between;font-size:13px;padding:8px 0}

.pg{display:none}.pg.on{display:block}

@media(max-width:900px){.side{width:64px;padding:16px 8px}.side .lt,.side .nt,.side .un,.side .up,.side .lo span{display:none}.ni{justify-content:center;padding:10px}.ub{justify-content:center}.mn{margin-left:64px;padding:20px}.g4{grid-template-columns:repeat(auto-fill,minmax(200px,1fr))}.g3,.g2{grid-template-columns:1fr}.hero{padding:32px 24px}.hero h1{font-size:26px}}

.modal-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.35);z-index:500;display:flex;align-items:center;justify-content:center;backdrop-filter:blur(2px)}
.modal{background:var(--bg-card);border-radius:var(--rl);padding:32px;width:90%;max-width:540px;max-height:85vh;overflow-y:auto;box-shadow:var(--s3);position:relative}
.modal-title{font-family:var(--fd);font-size:22px;font-weight:700;margin-bottom:20px}
.modal-close{position:absolute;top:16px;right:16px;width:32px;height:32px;border-radius:50%;border:none;background:var(--bg-el);display:flex;align-items:center;justify-content:center;color:var(--t2);cursor:pointer}.modal-close:hover{background:var(--bdr)}
.modal-actions{display:flex;gap:10px;justify-content:flex-end;margin-top:24px}
.ta{width:100%;padding:11px 14px;border:1px solid var(--bdr);border-radius:var(--rs);font-size:14px;background:var(--bg);color:var(--t1);outline:none;resize:vertical;min-height:80px;font-family:var(--fb)}.ta:focus{border-color:var(--green)}
@keyframes toastIn{from{transform:translateX(120%);opacity:0}to{transform:translateX(0);opacity:1}}
@keyframes toastOut{to{transform:translateX(120%);opacity:0}}
.toast-wrap{position:fixed;top:20px;right:20px;z-index:600;display:flex;flex-direction:column;gap:8px;pointer-events:none}
.toast{padding:14px 20px;border-radius:var(--rm);box-shadow:var(--s2);font-size:14px;font-weight:500;animation:toastIn .3s var(--ez) both;min-width:260px;color:#fff}
.toast.success{background:var(--green)}.toast.error{background:var(--red)}.toast.info{background:var(--t1)}
.toast.out{animation:toastOut .3s var(--ez) both}
.bd-hero{display:flex;gap:32px;margin-bottom:32px}
.bd-cover{width:200px;height:280px;border-radius:var(--rm);background-size:cover;background-position:center;flex-shrink:0;box-shadow:var(--s2)}
.brd{background:var(--red);color:#fff;border:none}.brd:hover{background:#9A3030}
@media(max-width:900px){.bd-hero{flex-direction:column;align-items:center}.bd-cover{width:160px;height:220px}}
</style>
</head>
<body>

<div id="auth" class="ap afi">
  <div class="aw af">
    <div style="text-align:center;margin-bottom:40px">
      <div class="logo" style="display:inline-flex;margin-bottom:10px">
        <div class="lm"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg></div>
        <span class="lt">BookWise</span>
      </div>
      <p style="color:var(--t2);font-size:15px">Key insights from the world's best books</p>
    </div>
    <div class="ac">
      <div class="at"><button class="atb on" onclick="swTab('login')">Sign In</button><button class="atb" onclick="swTab('register')">Sign Up</button></div>
      <div id="nf" class="ig" style="display:none"><label class="il">Name</label><input class="inp" id="aname" placeholder="Your name"></div>
      <div class="ig"><label class="il">Email</label><input class="inp" type="email" id="aem" placeholder="you@example.com" value="demo@bookwise.co"></div>
      <div class="ig"><label class="il">Password</label><input class="inp" type="password" id="apw" placeholder="••••••••" value="demo123" onkeydown="if(event.key==='Enter')doAuth()"></div>
      <div id="aerr" style="color:var(--red);font-size:13px;margin-bottom:12px;display:none"></div>
      <button class="btn bp blg bf" onclick="doAuth()" id="abtn">Sign In</button>
      <p style="text-align:center;margin-top:20px;font-size:12px;color:var(--t3);line-height:1.6">Demo: demo@bookwise.co / demo123<br>Merchant: merchant@bookwise.co / admin123</p>
    </div>
  </div>
</div>

<div id="app" class="app">
  <nav class="side" id="side"></nav>
  <div class="mn">
    <div id="p-home" class="pg"></div>
    <div id="p-explore" class="pg"></div>
    <div id="p-library" class="pg"></div>
    <div id="p-profile" class="pg"></div>
    <div id="p-reading" class="pg"></div>
    <div id="p-dashboard" class="pg"></div>
    <div id="p-books" class="pg"></div>
    <div id="p-users" class="pg"></div>
    <div id="p-settings" class="pg"></div>
    <div id="p-detail" class="pg"></div>
  </div>
</div>

<script>
const I={book:`<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>`,home:`<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9,22 9,12 15,12 15,22"/></svg>`,search:`<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>`,library:`<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>`,user:`<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>`,star:`<svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor"><polygon points="12,2 15.09,8.26 22,9.27 17,14.14 18.18,21.02 12,17.77 5.82,21.02 7,14.14 2,9.27 8.91,8.26"/></svg>`,clock:`<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12,6 12,12 16,14"/></svg>`,play:`<svg width="18" height="18" viewBox="0 0 24 24" fill="#fff"><polygon points="6,3 20,12 6,21"/></svg>`,pause:`<svg width="18" height="18" viewBox="0 0 24 24" fill="#fff"><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></svg>`,aL:`<svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12,19 5,12 12,5"/></svg>`,aR:`<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12,5 19,12 12,19"/></svg>`,ck:`<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20,6 9,17 4,12"/></svg>`,chart:`<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg>`,settings:`<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>`,logout:`<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16,17 21,12 16,7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>`,hp:`<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M3 18v-6a9 9 0 0 1 18 0v6"/><path d="M21 19a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3zM3 19a2 2 0 0 0 2 2h1a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2H3z"/></svg>`,tu:`<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23,6 13.5,15.5 8.5,10.5 1,18"/><polyline points="17,6 23,6 23,12"/></svg>`,users:`<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>`,bme:`<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"/></svg>`,x_:`<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>`,edit:`<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>`,trash:`<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><polyline points="3,6 5,6 21,6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>`,dl:`<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7,10 12,15 17,10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>`,bmf:`<svg width="16" height="16" viewBox="0 0 24 24" fill="var(--green)" stroke="var(--green)" stroke-width="1.8"><path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"/></svg>`};

let B=[
{id:"b1",title:"Atomic Habits",author:"James Clear",cat:"Productivity",cover:"https://images.unsplash.com/photo-1544716278-ca5e3f4abd8c?w=300&h=420&fit=crop",rating:4.8,reads:12400,dur:"15 min",added:"2025-12-01",ki:[{t:"The Power of 1% Better",c:"Small habits compound enormously. Getting 1% better each day makes you 37 times better over a year. Habits are the compound interest of self-improvement."},{t:"Forget Goals, Focus on Systems",c:"Goals are results; systems are processes. You don't rise to the level of your goals — you fall to the level of your systems. Winners and losers share the same goals."},{t:"The Four Laws of Behavior Change",c:"Every habit follows: cue, craving, response, reward. Build good habits by making them obvious, attractive, easy, and satisfying. Break bad ones by inverting."},{t:"Identity-Based Habits",c:"Focus on who you wish to become, not what you want to achieve. Every action is a vote for your future identity. True behavior change is identity change."},{t:"The Two-Minute Rule",c:"New habits should take less than two minutes. Master the habit of showing up first. The actions that follow can be challenging, but starting must be easy."}]},
{id:"b2",title:"Deep Work",author:"Cal Newport",cat:"Productivity",cover:"https://images.unsplash.com/photo-1456513080510-7bf3a84b82f8?w=300&h=420&fit=crop",rating:4.7,reads:9800,dur:"13 min",added:"2025-11-20",ki:[{t:"Deep Work is Rare and Valuable",c:"Deep work lets you master complicated information and produce better results faster. In a fragmented economy, cultivating focus is a superpower."},{t:"Schedule Every Minute",c:"Time-block your workday. Not every minute will go as planned, but maintaining a thoughtful say in your time use dramatically increases productivity."},{t:"Embrace Boredom",c:"Concentration is a skill requiring training. Constant smartphone relief rewires your brain away from deep work capacity."}]},
{id:"b3",title:"Thinking, Fast and Slow",author:"Daniel Kahneman",cat:"Psychology",cover:"https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=300&h=420&fit=crop",rating:4.6,reads:15200,dur:"18 min",added:"2025-10-15",ki:[{t:"Two Systems of Thinking",c:"System 1: automatic, fast, effortless. System 2: deliberate, slow, effortful. Their efficient labor division minimizes effort and optimizes performance."},{t:"Loss Aversion",c:"Losing $100 hurts more than gaining $150 feels good. This asymmetry between positive and negative experiences has deep evolutionary roots."},{t:"The Planning Fallacy",c:"We systematically underestimate costs, timelines, and risks while overestimating benefits. Consulting statistics of similar cases dramatically improves forecasts."}]},
{id:"b4",title:"The Psychology of Money",author:"Morgan Housel",cat:"Finance",cover:"https://images.unsplash.com/photo-1554224155-6726b3ff858f?w=300&h=420&fit=crop",rating:4.9,reads:18700,dur:"14 min",added:"2025-12-10",ki:[{t:"No One's Crazy",c:"Your personal experience with money is a tiny fraction of reality but shapes 80% of your worldview. Different generations have vastly different perspectives."},{t:"Compounding",c:"Good investing isn't about highest returns — it's earning decent returns consistently over the longest time. Compounding's power is deeply counterintuitive."},{t:"Wealth is What You Don't See",c:"Spending to show wealth is the fastest way to lose it. True wealth is the cars not purchased, the diamonds not bought, the assets still growing."}]},
{id:"b5",title:"Sapiens",author:"Yuval Noah Harari",cat:"History",cover:"https://images.unsplash.com/photo-1524995997946-a1c2e315a42f?w=300&h=420&fit=crop",rating:4.7,reads:21000,dur:"20 min",added:"2025-08-05",ki:[{t:"The Cognitive Revolution",c:"70,000 years ago, Homo sapiens gained unprecedented communication abilities, enabling large-scale cooperation through shared myths — nations, money, religions."},{t:"Imagined Orders",c:"Money, nations, human rights, and corporations exist because we collectively believe in them. These aren't lies — they're powerful shared stories enabling coordination."}]},
{id:"b6",title:"Start with Why",author:"Simon Sinek",cat:"Leadership",cover:"https://images.unsplash.com/photo-1519389950473-47ba0277781c?w=300&h=420&fit=crop",rating:4.5,reads:8900,dur:"12 min",added:"2025-11-01",ki:[{t:"The Golden Circle",c:"Every organization knows WHAT they do. Some know HOW. Very few know WHY. Why isn't about money — it's purpose, cause, belief."},{t:"People Don't Buy What You Do",c:"People buy WHY you do it. Do business with people who believe what you believe, not just anyone who needs your product."}]},
{id:"b7",title:"Mindset",author:"Carol Dweck",cat:"Psychology",cover:"https://images.unsplash.com/photo-1493836512294-502baa1986e2?w=300&h=420&fit=crop",rating:4.6,reads:11200,dur:"14 min",added:"2025-10-20",ki:[{t:"Fixed vs Growth Mindset",c:"Fixed: talents are static. Growth: abilities develop through work. The mindset you adopt profoundly affects how you lead your life."},{t:"The Power of Yet",c:"Adding 'yet' to 'I can't do this' shifts the frame from failure to learning, from inability to potential. It transforms effort's meaning."}]},
{id:"b8",title:"Zero to One",author:"Peter Thiel",cat:"Business",cover:"https://images.unsplash.com/photo-1486406146926-c627a92ad1ab?w=300&h=420&fit=crop",rating:4.5,reads:7600,dur:"11 min",added:"2025-09-10",ki:[{t:"Zero to One vs One to N",c:"0→1 is true innovation; 1→n is copying. The next great founder won't replicate existing products — they'll create entirely new categories."},{t:"Competition is for Losers",c:"Competition eliminates profits. Creative monopolists build new things that benefit everyone while earning sustained returns."}]},
{id:"b9",title:"The Lean Startup",author:"Eric Ries",cat:"Business",cover:"https://images.unsplash.com/photo-1460925895917-afdab827c52f?w=300&h=420&fit=crop",rating:4.4,reads:6500,dur:"13 min",added:"2025-07-22",ki:[{t:"Build-Measure-Learn",c:"Turn ideas into products, measure customer response, learn whether to pivot or persevere. Accelerate this feedback loop above all else."},{t:"Minimum Viable Product",c:"The MVP collects maximum validated learning with minimum effort. It's not the smallest product — it's the fastest path to real customer insight."}]},
{id:"b10",title:"Educated",author:"Tara Westover",cat:"Memoir",cover:"https://images.unsplash.com/photo-1481627834876-b7833e8f5570?w=300&h=420&fit=crop",rating:4.8,reads:14300,dur:"16 min",added:"2025-06-18",ki:[{t:"The Power of Education",c:"Education isn't facts — it's learning to think independently and question given narratives. Westover's journey from Idaho junkyard to Cambridge shows its transformative power."},{t:"The Cost of Transformation",c:"Growth has a price. Gaining education meant losing family understanding. Sometimes you must choose between who you were and who you could become."}]}
];
const C=["All","Productivity","Psychology","Finance","History","Leadership","Business","Memoir"];
const P=[{id:"free",n:"Free",p:0,f:["1 summary per day","Browse library","Basic categories"]},{id:"basic",n:"Basic",p:7.99,f:["5 summaries per day","Save to library","All categories","Offline reading"]},{id:"premium",n:"Premium",p:14.99,f:["Unlimited summaries","Audio narration","Personalized picks","Priority support"]}];
const MS={tu:24850,as:18200,mr:187450,cr:3.2,ast:"12m 34s",br:89400,rh:[{m:"Jul",r:142e3},{m:"Aug",r:151e3},{m:"Sep",r:158e3},{m:"Oct",r:167e3},{m:"Nov",r:178e3},{m:"Dec",r:187450}],tb:["b4","b5","b1","b3","b10"],ug:[{m:"Jul",u:18200},{m:"Aug",u:19800},{m:"Sep",u:21100},{m:"Oct",u:22400},{m:"Nov",u:23600},{m:"Dec",u:24850}]};
let MU=[{n:"Alex Rivera",e:"alex@example.com",p:"premium",j:"2025-09-15",br:47},{n:"Sarah Chen",e:"sarah@example.com",p:"basic",j:"2025-10-02",br:23},{n:"Marcus Williams",e:"marcus@example.com",p:"premium",j:"2025-08-20",br:62},{n:"Emily Park",e:"emily@example.com",p:"free",j:"2025-11-15",br:5},{n:"James Turner",e:"james@example.com",p:"premium",j:"2025-07-01",br:89},{n:"Priya Sharma",e:"priya@example.com",p:"basic",j:"2025-10-28",br:18}];

let S={u:null,pg:'home',am:'login',sv:new Set(['b1','b4']),rp:{},cb:null,ci:0,ri:new Set(),ap:false,apg:0,ai:null,ec:'All',es:'',bs:'',lt:'saved',sp:false};

function swTab(m){S.am=m;document.querySelectorAll('.atb').forEach((t,i)=>t.classList.toggle('on',(m==='login'&&i===0)||(m==='register'&&i===1)));document.getElementById('nf').style.display=m==='register'?'block':'none';document.getElementById('abtn').textContent=m==='login'?'Sign In':'Create Account';document.getElementById('aerr').style.display='none';}

function doAuth(){const e=document.getElementById('aem').value,p=document.getElementById('apw').value,er=document.getElementById('aerr');if(S.am==='login'){const u=[{id:"u1",email:"demo@bookwise.co",pw:"demo123",name:"Alex",plan:"premium",join:"2025-09-15",av:"A"},{id:"u2",email:"merchant@bookwise.co",pw:"admin123",name:"Admin",plan:"merchant",join:"2025-01-01",av:"M",role:"merchant"}].find(x=>x.email===e&&x.pw===p);if(u)logIn({id:u.id,email:u.email,name:u.name,plan:u.plan,joinedAt:u.join,avatar:u.av,role:u.role});else{er.textContent='Invalid credentials';er.style.display='block';}}else{const n=document.getElementById('aname').value;if(!n.trim()){er.textContent='Name required';er.style.display='block';return;}logIn({id:'u'+Date.now(),email:e,name:n,plan:'free',joinedAt:new Date().toISOString().split('T')[0],avatar:n[0].toUpperCase()});}}

function logIn(u){S.u=u;document.getElementById('auth').style.display='none';document.getElementById('app').classList.add('on');S.pg=u.role==='merchant'?'dashboard':'home';rSide();nav(S.pg);}
function logOut(){S.u=null;stopA();document.getElementById('auth').style.display='flex';document.getElementById('app').classList.remove('on');}

function nav(p){stopA();S.pg=p;document.querySelectorAll('.pg').forEach(x=>x.classList.remove('on'));document.querySelectorAll('.ni').forEach(x=>x.classList.remove('on'));const nb=document.querySelector(`[data-p="${p}"]`);if(nb)nb.classList.add('on');const el=document.getElementById('p-'+p);if(el)el.classList.add('on');({home:rHome,explore:rExplore,library:rLib,profile:rProf,reading:rRead,detail:rDetail,dashboard:rDash,books:rBMgmt,users:rUMgmt,settings:rSet})[p]?.();}

function rSide(){const u=S.u,m=u?.role==='merchant';const ni=m?[{id:'dashboard',ic:'chart',l:'Dashboard'},{id:'books',ic:'book',l:'Books'},{id:'users',ic:'users',l:'Users'},{id:'settings',ic:'settings',l:'Settings'}]:[{id:'home',ic:'home',l:'Home'},{id:'explore',ic:'search',l:'Explore'},{id:'library',ic:'library',l:'My Library'},{id:'profile',ic:'user',l:'Profile'}];
document.getElementById('side').innerHTML=`<div class="logo"><div class="lm"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg></div><span class="lt">BookWise</span></div><div style="flex:1">${ni.map(n=>`<button class="ni ${S.pg===n.id?'on':''}" data-p="${n.id}" onclick="nav('${n.id}')">${I[n.ic]}<span class="nt">${n.l}</span></button>`).join('')}</div><div class="sf"><div class="ub"><div class="av">${u?.avatar||'?'}</div><div><div class="un">${u?.name||''}</div><div class="up">${u?.plan||''} plan</div></div></div><button class="lo" onclick="logOut()">${I.logout}<span>Sign Out</span></button></div>`;}

function gB(c,s){let b=[...B];if(c&&c!=='All')b=b.filter(x=>x.cat===c);if(s)b=b.filter(x=>x.title.toLowerCase().includes(s.toLowerCase())||x.author.toLowerCase().includes(s.toLowerCase()));return b;}
function tSv(id,e){if(e)e.stopPropagation();if(S.sv.has(id))S.sv.delete(id);else S.sv.add(id);nav(S.pg);}
function oB(id){const b=B.find(x=>x.id===id);if(!b)return;S.cb=b;S.ci=0;S.ri=new Set([0]);S.ap=false;S.apg=0;nav('reading');}

function bC(b,d=0){const sv=S.sv.has(b.id);const prog=S.rp[b.id]||0;const pbar=prog>0&&prog<100?'<div style="margin-bottom:8px"><div style="height:3px;background:var(--bdr);border-radius:2px;overflow:hidden"><div style="height:100%;background:var(--green);width:'+prog+'%;border-radius:2px"></div></div><div style="font-size:11px;color:var(--t3);margin-top:3px">'+Math.round(prog)+'% complete</div></div>':prog>=100?'<div style="font-size:11px;color:var(--green);font-weight:600;margin-bottom:8px">'+I.ck+' Completed</div>':'';return`<div class="bc af d${d}" onclick="openDetail('${b.id}')"><div class="bcv" style="background-image:url('${b.cover}')"><button class="bsv" onclick="tSv('${b.id}',event)">${sv?I.bmf:I.bme}</button><span class="bct">${b.cat}</span></div><div class="bi"><div class="bt">${b.title}</div><div class="ba">${b.author}</div>${pbar}<div class="bm"><span class="rt">${I.star} ${b.rating}</span><span class="dr">${I.clock} ${b.dur}</span><span>${b.reads.toLocaleString()} reads</span></div></div></div>`;}

function rHome(){const u=S.u;const rec=[...B].sort(()=>Math.random()-.5).slice(0,4);const tr=[...B].sort((a,b)=>b.reads-a.reads).slice(0,4);const rc=[...B].sort((a,b)=>new Date(b.added)-new Date(a.added)).slice(0,4);
document.getElementById('p-home').innerHTML=`<div class="hero af"><p style="font-size:14px;opacity:.7;margin-bottom:6px;font-weight:500">Welcome back, ${u?.name}</p><h1>What will you learn today?</h1><p style="font-size:15px;opacity:.72;max-width:460px;line-height:1.7">Get the key insights from bestselling books in just 15 minutes.</p></div>
<div style="margin-bottom:48px"><div style="margin-bottom:18px"><div class="st">Recommended for You</div><div style="font-size:14px;color:var(--t2);margin-top:2px">Based on your reading habits</div></div><div class="g4">${rec.map((b,i)=>bC(b,i+1)).join('')}</div></div>
<div style="margin-bottom:48px"><div style="margin-bottom:18px"><div class="st">Trending Now</div><div style="font-size:14px;color:var(--t2);margin-top:2px">Most popular this week</div></div><div class="g4">${tr.map((b,i)=>bC(b,i+1)).join('')}</div></div>
<div style="margin-bottom:48px"><div style="margin-bottom:18px"><div class="st">Recently Added</div></div><div class="g4">${rc.map((b,i)=>bC(b,i+1)).join('')}</div></div>`;}

function rExplore(){const bs=gB(S.ec,S.es);document.getElementById('p-explore').innerHTML=`<div class="ptl" style="margin-bottom:24px">Explore</div><div class="sw" style="margin-bottom:24px">${I.search}<input class="inp" placeholder="Search books, authors..." value="${S.es}" oninput="S.es=this.value;rExplore()"></div><div class="cp">${C.map(c=>`<button class="cpl ${c===S.ec?'on':''}" onclick="S.ec='${c}';rExplore()">${c}</button>`).join('')}</div><p style="font-size:13px;color:var(--t3);margin-bottom:16px">${bs.length} books found</p><div class="g4">${bs.map((b,i)=>bC(b,Math.min(i+1,6))).join('')}</div>`;}

function rLib(){const sv=B.filter(b=>S.sv.has(b.id)),ip=B.filter(b=>S.rp[b.id]&&S.rp[b.id]<100),cm=B.filter(b=>S.rp[b.id]>=100);const ts=[{id:'saved',l:'Saved',c:sv.length},{id:'progress',l:'In Progress',c:ip.length},{id:'completed',l:'Completed',c:cm.length}];const cur=S.lt==='saved'?sv:S.lt==='progress'?ip:cm;
document.getElementById('p-library').innerHTML=`<div class="ptl" style="margin-bottom:24px">My Library</div><div class="tabs">${ts.map(t=>`<button class="tb ${S.lt===t.id?'on':''}" onclick="S.lt='${t.id}';rLib()">${t.l}<span style="margin-left:4px;font-size:11px;opacity:.6">${t.c}</span></button>`).join('')}</div>${cur.length===0?`<div class="es">${I.library}<p>${S.lt==='saved'?'Save books to build your library':S.lt==='progress'?'Start reading to track progress':'Complete books to see them here'}</p></div>`:`<div class="g4">${cur.map((b,i)=>bC(b,Math.min(i+1,6))).join('')}</div>`}`;}

function rProf(){const u=S.u,pc=u.plan==='premium'?'sbp':u.plan==='basic'?'sbb':'sbf';
document.getElementById('p-profile').innerHTML=`<div class="ptl" style="margin-bottom:28px">Profile</div><div class="prc af"><div style="display:flex;align-items:center;gap:20px;margin-bottom:24px"><div class="av av-l">${u.avatar}</div><div><div style="font-size:20px;font-weight:600">${u.name}</div><div style="font-size:14px;color:var(--t2)">${u.email}</div><div style="font-size:12px;color:var(--t3);margin-top:2px">Member since ${u.joinedAt}</div></div><button class="btn bs bsm" onclick="showEditProfile()">Edit Profile</button></div></div>
<div class="prc af d1"><div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px"><div class="st" style="font-size:18px">Subscription</div><span class="sbg ${pc}">${u.plan}</span></div><button class="btn ${u.plan==='premium'?'bs':'bp'} bmd" onclick="S.sp=!S.sp;rProf()">${u.plan==='premium'?'Manage Plan':'Upgrade Plan'}</button></div>
${S.sp?`<div class="g3 af d2">${P.map(p=>{const ic=u.plan===p.id;return`<div class="plc ${ic?'cur':''}">${ic?'<div class="pcb">Current</div>':''}<div class="pln">${p.n}</div><div class="plp">$${p.p}<span>/mo</span></div><div style="margin-bottom:20px">${p.f.map(f=>`<div class="plf">${I.ck} ${f}</div>`).join('')}</div><button class="btn ${ic?'bs':'bp'} bsm bf" ${ic?'disabled':''} onclick="S.u.plan='${p.id}';S.sp=false;rProf();rSide()">${ic?'Current':'Select'}</button></div>`;}).join('')}</div>`:''}`;}

function rRead(){const b=S.cb;if(!b){nav('home');return;}const t=b.ki.length,x=S.ci,pp=(S.ri.size/t)*100;S.rp[b.id]=pp;save();
document.getElementById('p-reading').innerHTML=`<div style="max-width:800px;margin:0 auto"><div class="rh af"><button class="rb" onclick="nav('detail')">${I.aL}</button><div style="flex:1"><div class="rtl">${b.title}</div><div class="rau">by ${b.author}</div></div></div>
<div class="pb af d1"><div class="pbl"><span>Progress</span><span>${Math.round(pp)}%</span></div><div class="pt"><div class="pf" style="width:${pp}%"></div></div></div>
<div class="abr af d2"><button class="plb" onclick="tA()">${S.ap?I.pause:I.play}</button><div class="aif"><div class="ail">${I.hp} Audio Narration</div><div class="ait"><div class="aifll" id="afill" style="width:${S.apg}%"></div></div></div><span class="atm">${fAT(S.apg)} / ${b.dur}</span></div>
<div class="ids af d3">${b.ki.map((_,i)=>`<button class="idd ${i===x?'cur':S.ri.has(i)?'rd':'ur'}" onclick="gI(${i})">${i+1}</button>`).join('')}</div>
<div class="ic af" id="icnt"><div class="inum">Key Insight ${x+1} of ${t}</div><div class="ihd">${b.ki[x].t}</div><div class="ibd">${b.ki[x].c}</div></div>
<div class="rnv"><button class="btn bs bmd" ${x===0?'disabled':''} onclick="gI(${x-1})">${I.aL} Previous</button>${x===t-1?'<button class="btn bp bmd" onclick="markComplete()">'+((S.rp[b.id]>=100)?'✓ Completed':'Mark Complete')+'</button>':'<button class="btn bp bmd" onclick="gI(${x+1})">Next '+I.aR+'</button>'}</div></div>`;}

function gI(i){if(!S.cb)return;const t=S.cb.ki.length;if(i<0||i>=t)return;S.ci=i;S.ri.add(i);stopA();S.apg=0;rRead();}
function tA(){if(S.ap){stopA();}else{S.ap=true;S.ai=setInterval(()=>{S.apg+=.5;if(S.apg>=100){stopA();return;}const f=document.getElementById('afill');if(f)f.style.width=S.apg+'%';},100);}rRead();}
function stopA(){S.ap=false;if(S.ai){clearInterval(S.ai);S.ai=null;}}
function fAT(p){const s=p*.15*60;return Math.floor(s/60)+':'+String(Math.floor(s%60)).padStart(2,'0');}

function rDash(){const s=MS,mx=Math.max(...s.rh.map(r=>r.r)),mu=Math.max(...s.ug.map(r=>r.u));
document.getElementById('p-dashboard').innerHTML=`<div class="ph"><div><div class="ptl">Dashboard</div><div style="font-size:14px;color:var(--t2)">Merchant analytics overview</div></div><button class="btn bs bsm" onclick="exportDashData()">${I.dl} Export</button></div>
<div style="display:grid;grid-template-columns:repeat(4,1fr);gap:16px;margin-bottom:32px">${[{ic:'users',l:'Total Users',v:s.tu.toLocaleString(),ch:'+5.3%'},{ic:'book',l:'Active Subs',v:s.as.toLocaleString(),ch:'+3.8%'},{ic:'chart',l:'Monthly Revenue',v:'$'+(s.mr/1e3).toFixed(1)+'K',ch:'+5.3%'},{ic:'book',l:'Books Read',v:s.br.toLocaleString(),ch:'+12.1%'}].map((c,i)=>`<div class="scd af d${i+1}"><div class="sct"><div class="sci">${I[c.ic]}</div><span class="sch">${I.tu} ${c.ch}</span></div><div class="scl">${c.l}</div><div class="scv">${c.v}</div></div>`).join('')}</div>
<div class="ccd af d3"><div class="cct">Revenue Trend</div><div class="cbs">${s.rh.map((r,i)=>`<div class="ccl"><div class="cbw"><div class="cb" style="height:${(r.r/mx)*100}%;animation-delay:${i*.08}s"></div></div><div class="cmn">${r.m}</div><div class="cvl">$${(r.r/1e3).toFixed(0)}K</div></div>`).join('')}</div></div>
<div class="g2"><div class="ccd af d4"><div class="cct">Top Books</div>${s.tb.map((id,i)=>{const b=B.find(x=>x.id===id);return b?`<div class="tbr"><span class="trk">${i+1}</span><div class="tth" style="background-image:url('${b.cover}')"></div><div style="flex:1"><div style="font-size:14px;font-weight:500">${b.title}</div><div style="font-size:12px;color:var(--t3)">${b.reads.toLocaleString()} reads</div></div></div>`:''}).join('')}</div>
<div class="ccd af d5"><div class="cct">User Growth</div><div class="cbs" style="height:180px">${s.ug.map((r,i)=>`<div class="ccl"><div class="cbw"><div class="cb cbl" style="height:${(r.u/mu)*100}%;animation-delay:${i*.08}s"></div></div><div class="cmn">${r.m}</div><div class="cvl">${(r.u/1e3).toFixed(1)}K</div></div>`).join('')}</div><div style="margin-top:20px;padding:14px;background:var(--bg-el);border-radius:var(--rs)"><div class="ir"><span style="color:var(--t2)">Churn Rate</span><span style="font-weight:600">${s.cr}%</span></div><div class="ir"><span style="color:var(--t2)">Avg Session</span><span style="font-weight:600">${s.ast}</span></div></div></div></div>`;}

function rBMgmt(){const bs=gB(null,S.bs);document.getElementById('p-books').innerHTML=`<div class="ph"><div class="ptl">Books Management</div><div style="display:flex;gap:8px"><button class="btn bs bsm" onclick="exportBooksCSV()">${I.dl} Export</button><button class="btn bp bsm" onclick="showAddBook()">+ Add Book</button></div></div><div class="sw" style="margin-bottom:24px;max-width:400px">${I.search}<input class="inp" placeholder="Search books..." value="${S.bs}" oninput="S.bs=this.value;rBMgmt()"></div>
<div class="tw af"><table><thead><tr><th>Book</th><th>Category</th><th>Rating</th><th>Reads</th><th>Duration</th><th>Added</th><th>Actions</th></tr></thead><tbody>${bs.map(b=>`<tr style="cursor:pointer" onclick="openDetail('${b.id}')"><td><div class="tbk"><div class="tth" style="background-image:url('${b.cover}')"></div><div><div style="font-size:14px;font-weight:500">${b.title}</div><div style="font-size:12px;color:var(--t3)">${b.author}</div></div></div></td><td><span style="background:var(--bg-el);padding:3px 10px;border-radius:12px;font-size:12px">${b.cat}</span></td><td><span style="color:var(--amber);display:flex;align-items:center;gap:3px">${I.star} ${b.rating}</span></td><td style="font-variant-numeric:tabular-nums">${b.reads.toLocaleString()}</td><td>${b.dur}</td><td style="color:var(--t3)">${b.added}</td><td><button class="btn bg bsm" onclick="event.stopPropagation();showEditBook('${b.id}')">${I.edit}</button><button class="btn bg bsm" style="color:var(--red)" onclick="event.stopPropagation();deleteBook('${b.id}')">${I.trash}</button></td></tr>`).join('')}</tbody></table></div>`;}

function rUMgmt(){document.getElementById('p-users').innerHTML=`<div class="ph"><div class="ptl">Users</div><div style="display:flex;gap:8px"><button class="btn bs bsm" onclick="exportUsersCSV()">${I.dl} Export CSV</button><button class="btn bp bsm" onclick="showInvite()">Invite Users</button></div></div>
<div class="g3" style="margin-bottom:24px">${[{l:'Free Users',v:'6,650'},{l:'Basic Users',v:'8,400'},{l:'Premium Users',v:'9,800'}].map((s,i)=>`<div class="scd af d${i+1}"><div class="scl">${s.l}</div><div class="scv">${s.v}</div></div>`).join('')}</div>
<div class="tw af d3"><table><thead><tr><th>User</th><th>Plan</th><th>Joined</th><th>Books Read</th><th>Actions</th></tr></thead><tbody>${MU.map(u=>{const pc=u.p==='premium'?'sbp':u.p==='basic'?'sbb':'sbf';return`<tr><td><div style="display:flex;align-items:center;gap:10px"><div class="av" style="width:30px;height:30px;font-size:11px">${u.n[0]}</div><div><div style="font-weight:500">${u.n}</div><div style="font-size:11px;color:var(--t3)">${u.e}</div></div></div></td><td><span class="sbg ${pc}">${u.p}</span></td><td style="color:var(--t3)">${u.j}</td><td style="font-variant-numeric:tabular-nums">${u.br}</td><td><button class="btn bg bsm" onclick="showUserDetail('${u.id}')">View</button></td></tr>`;}).join('')}</tbody></table></div>`;}

function rSet(){document.getElementById('p-settings').innerHTML=`<div class="ptl" style="margin-bottom:28px">Settings</div><div class="prc af"><div class="st" style="font-size:18px;margin-bottom:20px">General Settings</div><div class="ig"><label class="il">App Name</label><input class="inp" id="set-name" value="${appSettings.name}"></div><div class="ig"><label class="il">Support Email</label><input class="inp" id="set-email" value="${appSettings.email}"></div><div class="ig"><label class="il">Default Currency</label><input class="inp" id="set-cur" value="${appSettings.currency}"></div><button class="btn bp bmd" style="margin-top:8px" onclick="saveSettings()">Save Changes</button></div>
<div class="prc af d1"><div class="st" style="font-size:18px;margin-bottom:20px">Subscription Plans</div><p style="font-size:14px;color:var(--t2);margin-bottom:16px">Configure pricing and features for each plan tier.</p><div class="g3" style="gap:12px">${P.map(p=>`<div style="background:var(--bg-el);border-radius:var(--rs);padding:16px;text-align:center"><div style="font-weight:600;margin-bottom:4px">${p.n}</div><div style="font-family:var(--fd);font-size:22px;font-weight:700">$${p.p}<span style="font-size:12px;color:var(--t3)">/mo</span></div></div>`).join('')}</div><button class="btn bs bmd" style="margin-top:16px" onclick="showEditPlans()">Edit Plans</button></div>
<div class="prc af d2"><div class="st" style="font-size:18px;margin-bottom:20px">Danger Zone</div><p style="font-size:14px;color:var(--t2);margin-bottom:16px">Irreversible actions. Proceed with caution.</p><button class="btn bmd" style="background:var(--red);color:#fff;border:none" onclick="confirmDeleteData()">Delete All Data</button></div>`;}

// ═══ Persistence ═══
function save(){try{localStorage.setItem('bw',JSON.stringify({sv:[...S.sv],rp:S.rp,u:S.u,books:B,mu:MU,settings:typeof appSettings!=='undefined'?appSettings:null}))}catch(e){}}
function loadSaved(){try{const d=JSON.parse(localStorage.getItem('bw'));if(d){if(d.sv)S.sv=new Set(d.sv);if(d.rp)S.rp=d.rp;if(d.books&&d.books.length)B=d.books;if(d.mu)MU=d.mu;if(d.u){S.u=d.u;logIn(d.u,true);}}}catch(e){}}
let appSettings={name:'BookWise',email:'support@bookwise.co',currency:'USD'};

// ═══ Toast ═══
function toast(msg,type='success'){const el=document.createElement('div');el.className='toast '+type;el.textContent=msg;document.getElementById('toast-root').appendChild(el);setTimeout(()=>{el.classList.add('out');setTimeout(()=>el.remove(),300)},3000);}

// ═══ Modal ═══
function showModal(h){document.getElementById('modal-root').innerHTML='<div class="modal-overlay" onclick="if(event.target===this)closeModal()"><div class="modal">'+h+'</div></div>';}
function closeModal(){document.getElementById('modal-root').innerHTML='';}
function confirmDlg(title,msg,fn,label,cls){showModal('<button class="modal-close" onclick="closeModal()">'+I.x_+'</button><div class="modal-title">'+title+'</div><div style="font-size:15px;color:var(--t2);line-height:1.6;margin-bottom:4px">'+msg+'</div><div class="modal-actions"><button class="btn bs bmd" onclick="closeModal()">Cancel</button><button class="btn '+(cls||'bp')+' bmd" onclick="'+fn+'">'+label+'</button></div>');}

// ═══ CSV Export ═══
function exportCSV(rows,fn){const csv=rows.map(r=>r.map(c=>'"'+String(c).replace(/"/g,'""')+'"').join(',')).join('\n');const b=new Blob([csv],{type:'text/csv'});const a=document.createElement('a');a.href=URL.createObjectURL(b);a.download=fn;a.click();toast('Exported '+fn);}
function exportDashData(){const hdr=['Month','Revenue','Users'];const rows=[hdr,...MS.rh.map((r,i)=>[r.m,'$'+(r.r/1e3).toFixed(0)+'K',MS.ug[i]?.u||''])];exportCSV(rows,'bookwise-dashboard.csv');}
function exportUsersCSV(){const hdr=['Name','Email','Plan','Joined','Books Read'];const rows=[hdr,...MU.map(u=>[u.n,u.e,u.p,u.j,u.br])];exportCSV(rows,'bookwise-users.csv');}
function exportBooksCSV(){const hdr=['Title','Author','Category','Rating','Reads','Duration','Added'];const rows=[hdr,...B.map(b=>[b.title,b.author,b.cat,b.rating,b.reads,b.dur,b.added])];exportCSV(rows,'bookwise-books.csv');}

// ═══ Book CRUD ═══
function showAddBook(){showModal('<button class="modal-close" onclick="closeModal()">'+I.x_+'</button><div class="modal-title">Add New Book</div><div class="ig"><label class="il">Title *</label><input class="inp" id="nb-t" placeholder="Book title"></div><div class="ig"><label class="il">Author *</label><input class="inp" id="nb-a" placeholder="Author name"></div><div style="display:grid;grid-template-columns:1fr 1fr;gap:12px"><div class="ig"><label class="il">Category</label><select class="inp" id="nb-c">'+C.filter(c=>c!=='All').map(c=>'<option>'+c+'</option>').join('')+'</select></div><div class="ig"><label class="il">Duration</label><input class="inp" id="nb-d" value="12 min"></div></div><div class="ig"><label class="il">Cover Image URL</label><input class="inp" id="nb-cv" placeholder="https://..."></div><div class="ig"><label class="il">Synopsis</label><textarea class="ta" id="nb-s" placeholder="Brief description..."></textarea></div><div class="ig"><label class="il">Key Insights (one per line: Title | Content)</label><textarea class="ta" id="nb-ki" style="min-height:120px" placeholder="Insight Title | Content here..."></textarea></div><div class="modal-actions"><button class="btn bs bmd" onclick="closeModal()">Cancel</button><button class="btn bp bmd" onclick="addBook()">Add Book</button></div>');}

function addBook(){const t=document.getElementById('nb-t').value.trim(),a=document.getElementById('nb-a').value.trim();if(!t||!a){toast('Title and author required','error');return;}
const ki=document.getElementById('nb-ki').value.trim();const insights=ki?ki.split('\n').filter(l=>l.trim()).map(l=>{const p=l.split('|');return{t:p[0]?.trim()||'Key Takeaway',c:p[1]?.trim()||p[0]?.trim()}}):[{t:'Key Takeaway',c:document.getElementById('nb-s').value.trim()||t}];
B.unshift({id:'b'+Date.now(),title:t,author:a,cat:document.getElementById('nb-c').value,cover:document.getElementById('nb-cv').value.trim()||'https://images.unsplash.com/photo-1544947950-fa07a98d237f?w=300&h=420&fit=crop',rating:4.5,reads:0,dur:document.getElementById('nb-d').value.trim()||'10 min',added:new Date().toISOString().split('T')[0],synopsis:document.getElementById('nb-s').value.trim()||t,ki:insights});
save();closeModal();toast('"'+t+'" added!');nav(S.pg);}

function showEditBook(id){const b=B.find(x=>x.id===id);if(!b)return;showModal('<button class="modal-close" onclick="closeModal()">'+I.x_+'</button><div class="modal-title">Edit Book</div><div class="ig"><label class="il">Title</label><input class="inp" id="eb-t" value="'+b.title+'"></div><div class="ig"><label class="il">Author</label><input class="inp" id="eb-a" value="'+b.author+'"></div><div style="display:grid;grid-template-columns:1fr 1fr;gap:12px"><div class="ig"><label class="il">Category</label><select class="inp" id="eb-c">'+C.filter(c=>c!=='All').map(c=>'<option'+(c===b.cat?' selected':'')+'>'+c+'</option>').join('')+'</select></div><div class="ig"><label class="il">Duration</label><input class="inp" id="eb-d" value="'+b.dur+'"></div></div><div class="ig"><label class="il">Cover URL</label><input class="inp" id="eb-cv" value="'+b.cover+'"></div><div class="ig"><label class="il">Synopsis</label><textarea class="ta" id="eb-s">'+( b.synopsis||'')+'</textarea></div><div class="ig"><label class="il">Key Insights (Title | Content per line)</label><textarea class="ta" id="eb-ki" style="min-height:120px">'+b.ki.map(k=>k.t+' | '+k.c).join('\n')+'</textarea></div><div class="modal-actions"><button class="btn bs bmd" onclick="closeModal()">Cancel</button><button class="btn bp bmd" onclick="doEditBook(\''+id+'\')">Save</button></div>');}

function doEditBook(id){const b=B.find(x=>x.id===id);if(!b)return;b.title=document.getElementById('eb-t').value.trim()||b.title;b.author=document.getElementById('eb-a').value.trim()||b.author;b.cat=document.getElementById('eb-c').value;b.dur=document.getElementById('eb-d').value.trim()||b.dur;b.cover=document.getElementById('eb-cv').value.trim()||b.cover;b.synopsis=document.getElementById('eb-s').value.trim();const ki=document.getElementById('eb-ki').value.trim();if(ki)b.ki=ki.split('\n').filter(l=>l.trim()).map(l=>{const p=l.split('|');return{t:p[0]?.trim()||'Untitled',c:p[1]?.trim()||p[0]?.trim()}});save();closeModal();toast('"'+b.title+'" updated');nav(S.pg);}

function deleteBook(id){const b=B.find(x=>x.id===id);if(!b)return;confirmDlg('Delete Book','Are you sure you want to delete <strong>'+b.title+'</strong>?',"B=B.filter(x=>x.id!=='"+id+"');S.sv.delete('"+id+"');delete S.rp['"+id+"'];save();closeModal();toast('Book deleted');nav(S.u?.role==='merchant'?'books':'home')",'Delete','brd');}

// ═══ User CRUD ═══
function showUserDetail(id){const u=MU.find(x=>x.id===id);if(!u)return;const pc=u.p==='premium'?'sbp':u.p==='basic'?'sbb':'sbf';showModal('<button class="modal-close" onclick="closeModal()">'+I.x_+'</button><div class="modal-title">User Details</div><div style="display:flex;align-items:center;gap:16px;margin-bottom:20px"><div class="av av-l">'+u.n[0]+'</div><div><div style="font-size:18px;font-weight:600">'+u.n+'</div><div style="font-size:14px;color:var(--t2)">'+u.e+'</div></div></div><div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:20px"><div><div style="font-size:12px;color:var(--t3)">Plan</div><span class="sbg '+pc+'">'+u.p+'</span></div><div><div style="font-size:12px;color:var(--t3)">Joined</div><div style="font-weight:500">'+u.j+'</div></div><div><div style="font-size:12px;color:var(--t3)">Books Read</div><div style="font-weight:500">'+u.br+'</div></div><div><div style="font-size:12px;color:var(--t3)">Status</div><div style="color:var(--green);font-weight:600">Active</div></div></div><div class="modal-actions"><button class="btn bs bmd" onclick="closeModal()">Close</button><button class="btn bp bmd" onclick="showEditUser(\''+id+'\')">Edit</button></div>');}

function showEditUser(id){const u=MU.find(x=>x.id===id);if(!u)return;showModal('<button class="modal-close" onclick="closeModal()">'+I.x_+'</button><div class="modal-title">Edit User</div><div class="ig"><label class="il">Name</label><input class="inp" id="eu-n" value="'+u.n+'"></div><div class="ig"><label class="il">Email</label><input class="inp" id="eu-e" value="'+u.e+'"></div><div class="ig"><label class="il">Plan</label><select class="inp" id="eu-p"><option'+(u.p==='free'?' selected':'')+'>free</option><option'+(u.p==='basic'?' selected':'')+'>basic</option><option'+(u.p==='premium'?' selected':'')+'>premium</option></select></div><div class="modal-actions"><button class="btn brd bmd" onclick="deleteUser(\''+id+'\')">Delete</button><div style="flex:1"></div><button class="btn bs bmd" onclick="closeModal()">Cancel</button><button class="btn bp bmd" onclick="saveUser(\''+id+'\')">Save</button></div>');}

function saveUser(id){const u=MU.find(x=>x.id===id);if(!u)return;u.n=document.getElementById('eu-n').value.trim()||u.n;u.e=document.getElementById('eu-e').value.trim()||u.e;u.p=document.getElementById('eu-p').value;save();closeModal();toast('User updated');rUMgmt();}
function deleteUser(id){confirmDlg('Delete User','This action cannot be undone.',"MU=MU.filter(x=>x.id!=='"+id+"');save();closeModal();toast('User deleted');rUMgmt()",'Delete','brd');}

function showInvite(){showModal('<button class="modal-close" onclick="closeModal()">'+I.x_+'</button><div class="modal-title">Invite Users</div><div class="ig"><label class="il">Email addresses (one per line)</label><textarea class="ta" id="inv-e" style="min-height:100px" placeholder="user1@example.com"></textarea></div><div class="ig"><label class="il">Default Plan</label><select class="inp" id="inv-p"><option>free</option><option>basic</option><option selected>premium</option></select></div><div class="modal-actions"><button class="btn bs bmd" onclick="closeModal()">Cancel</button><button class="btn bp bmd" onclick="sendInvites()">Send Invites</button></div>');}
function sendInvites(){const emails=document.getElementById('inv-e').value.trim().split('\n').filter(e=>e.includes('@'));const plan=document.getElementById('inv-p').value;if(!emails.length){toast('Enter valid emails','error');return;}emails.forEach(e=>{MU.push({id:'mu'+Date.now()+Math.random(),n:e.split('@')[0],e:e.trim(),p:plan,j:new Date().toISOString().split('T')[0],br:0});});save();closeModal();toast(emails.length+' invite(s) sent!');rUMgmt();}

// ═══ Profile Edit ═══
function showEditProfile(){const u=S.u;showModal('<button class="modal-close" onclick="closeModal()">'+I.x_+'</button><div class="modal-title">Edit Profile</div><div class="ig"><label class="il">Name</label><input class="inp" id="ep-n" value="'+u.name+'"></div><div class="ig"><label class="il">Email</label><input class="inp" id="ep-e" value="'+u.email+'"></div><div class="modal-actions"><button class="btn bs bmd" onclick="closeModal()">Cancel</button><button class="btn bp bmd" onclick="saveProf()">Save</button></div>');}
function saveProf(){const n=document.getElementById('ep-n').value.trim(),e=document.getElementById('ep-e').value.trim();if(!n||!e){toast('Fields required','error');return;}S.u.name=n;S.u.email=e;S.u.avatar=n[0].toUpperCase();save();closeModal();toast('Profile updated');rProf();rSide();}

// ═══ Book Detail Page ═══
function openDetail(id){const b=B.find(x=>x.id===id);if(!b)return;S.cb=b;S.prevPg=S.pg;nav('detail');}
function startReading(id){const b=B.find(x=>x.id===id);if(!b)return;S.cb=b;S.ci=0;S.ri=new Set([0]);S.ap=false;S.apg=0;nav('reading');}
function rDetail(){const b=S.cb;if(!b){nav('home');return;}const sv=S.sv.has(b.id);const prog=S.rp[b.id]||0;const m=S.u?.role==='merchant';
document.getElementById('p-detail').innerHTML='<div style="max-width:900px;margin:0 auto"><div class="rh af"><button class="rb" onclick="nav(\''+(S.prevPg||'home')+'\')">'+I.aL+'</button><div style="flex:1"><span style="font-size:13px;color:var(--t3)">Book Details</span></div></div><div class="bd-hero af d1"><div class="bd-cover" style="background-image:url(\''+b.cover+'\')"></div><div style="flex:1"><div style="font-family:var(--fd);font-size:28px;font-weight:700;margin-bottom:6px;line-height:1.2">'+b.title+'</div><div style="font-size:16px;color:var(--t2);margin-bottom:16px">by '+b.author+'</div><div style="display:flex;gap:20px;margin-bottom:16px;font-size:14px;color:var(--t3)"><span style="color:var(--amber);display:flex;align-items:center;gap:4px">'+I.star+' '+b.rating+'</span><span style="display:flex;align-items:center;gap:4px">'+I.clock+' '+b.dur+'</span><span>'+b.reads.toLocaleString()+' reads</span><span>'+b.ki.length+' insights</span></div><div style="font-size:15px;color:var(--t2);line-height:1.7;margin-bottom:24px">'+(b.synopsis||'')+'</div>'+(prog>0?'<div style="margin-bottom:16px"><div class="pbl"><span>Your Progress</span><span>'+Math.round(prog)+'%</span></div><div class="pt"><div class="pf" style="width:'+prog+'%"></div></div></div>':'')+'<div style="display:flex;gap:10px;flex-wrap:wrap"><button class="btn bp bmd" onclick="startReading(\''+b.id+'\')">'+(prog>0&&prog<100?'Continue Reading':'Start Reading')+'</button><button class="btn '+(sv?'bp':'bo')+' bmd" onclick="tSv(\''+b.id+'\');rDetail()">'+(sv?I.bmf+' Saved':I.bme+' Save')+'</button>'+(m?'<button class="btn bs bsm" onclick="showEditBook(\''+b.id+'\')">'+I.edit+' Edit</button><button class="btn brd bsm" onclick="deleteBook(\''+b.id+'\')">'+I.trash+' Delete</button>':'')+'</div></div></div><div class="af d2"><div class="st" style="margin-bottom:18px">Key Insights Preview</div>'+b.ki.map((k,i)=>'<div style="background:var(--bg-card);border:1px solid var(--bl);border-radius:var(--rm);padding:20px;margin-bottom:12px;display:flex;align-items:start;gap:14px"><div style="width:30px;height:30px;border-radius:50%;background:var(--gl);color:var(--green);display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:600;flex-shrink:0">'+(i+1)+'</div><div><div style="font-family:var(--fd);font-size:16px;font-weight:600;margin-bottom:4px">'+k.t+'</div><div style="font-size:14px;color:var(--t3);line-height:1.5">'+k.c.substring(0,150)+'...</div></div></div>').join('')+'</div></div>';}

// ═══ Mark Complete ═══
function markComplete(){if(!S.cb)return;S.ri=new Set(S.cb.ki.map((_,i)=>i));S.rp[S.cb.id]=100;S.cb.reads++;save();toast('Finished "'+S.cb.title+'"!');rRead();}

// ═══ Settings Save ═══
function saveSettings(){appSettings.name=document.getElementById('set-name')?.value||appSettings.name;appSettings.email=document.getElementById('set-email')?.value||appSettings.email;appSettings.currency=document.getElementById('set-cur')?.value||appSettings.currency;save();toast('Settings saved');}
function showEditPlans(){toast('Plan editor coming soon','info');}
function confirmDeleteData(){confirmDlg('Delete All Data','This will permanently erase all books, users, and settings. This cannot be undone.',"localStorage.removeItem('bw');location.reload()",'Delete Everything','brd');}

// ═══ Override old logIn to support persistence ═══
const _origLogIn=logIn;
logIn=function(u,fromStorage){_origLogIn(u);if(!fromStorage){save();toast('Welcome, '+u.name+'!');}};

// ═══ Init persistence ═══
document.addEventListener('DOMContentLoaded',()=>loadSaved());

</script>
<div id="modal-root"></div>
<div class="toast-wrap" id="toast-root"></div>
</body>
</html>